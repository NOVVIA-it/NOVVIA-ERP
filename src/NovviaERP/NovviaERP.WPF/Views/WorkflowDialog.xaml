<Window x:Class="NovviaERP.WPF.Views.WorkflowDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Workflow bearbeiten" Height="550" Width="600"
        WindowStartupLocation="CenterOwner" ResizeMode="NoResize">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="120"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Name -->
        <TextBlock Grid.Row="0" Text="Name:" VerticalAlignment="Center" Margin="0,0,10,10"/>
        <TextBox Grid.Row="0" Grid.Column="1" x:Name="txtName" Margin="0,0,0,10"/>

        <!-- Beschreibung -->
        <TextBlock Grid.Row="1" Text="Beschreibung:" VerticalAlignment="Top" Margin="0,0,10,10"/>
        <TextBox Grid.Row="1" Grid.Column="1" x:Name="txtBeschreibung" Height="50" TextWrapping="Wrap"
                 AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Margin="0,0,0,10"/>

        <!-- Ereignis -->
        <TextBlock Grid.Row="2" Text="Ereignis:" VerticalAlignment="Center" Margin="0,0,10,10"/>
        <ComboBox Grid.Row="2" Grid.Column="1" x:Name="cmbEreignis" Margin="0,0,0,10">
            <ComboBoxItem Content="Bestellung erstellt" Tag="BestellungErstellt"/>
            <ComboBoxItem Content="Zahlung eingegangen" Tag="ZahlungEingang"/>
            <ComboBoxItem Content="Versand" Tag="Versand"/>
            <ComboBoxItem Content="RMA erstellt" Tag="RMAErstellt"/>
            <ComboBoxItem Content="Lagerbestand niedrig" Tag="LagerbestandNiedrig"/>
            <ComboBoxItem Content="Artikel geaendert" Tag="ArtikelGeaendert"/>
            <ComboBoxItem Content="Kunde erstellt" Tag="KundeErstellt"/>
            <ComboBoxItem Content="Rechnung erstellt" Tag="RechnungErstellt"/>
        </ComboBox>

        <!-- Bedingung -->
        <TextBlock Grid.Row="3" Text="Bedingung:" VerticalAlignment="Center" Margin="0,0,10,10"/>
        <Grid Grid.Row="3" Grid.Column="1" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox x:Name="txtBedingung" ToolTip="z.B. 'Status=3' oder 'Betrag>100' (leer = immer ausfuehren)"/>
            <Button Grid.Column="1" Content="?" Width="25" Margin="5,0,0,0" Click="BedingungHilfe_Click"/>
        </Grid>

        <!-- Aktionstyp -->
        <TextBlock Grid.Row="4" Text="Aktionstyp:" VerticalAlignment="Center" Margin="0,0,10,10"/>
        <ComboBox Grid.Row="4" Grid.Column="1" x:Name="cmbAktionTyp" SelectionChanged="AktionTyp_Changed" Margin="0,0,0,10">
            <ComboBoxItem Content="E-Mail senden" Tag="EMAIL"/>
            <ComboBoxItem Content="Webhook aufrufen" Tag="WEBHOOK"/>
            <ComboBoxItem Content="Status aendern" Tag="STATUS"/>
            <ComboBoxItem Content="SQL ausfuehren" Tag="SQL"/>
        </ComboBox>

        <!-- Aktion Parameter -->
        <TextBlock Grid.Row="5" Text="Parameter:" VerticalAlignment="Top" Margin="0,0,10,10"/>
        <Grid Grid.Row="5" Grid.Column="1" Margin="0,0,0,10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- EMAIL Parameter -->
            <StackPanel x:Name="pnlEmail" Visibility="Visible">
                <Grid Margin="0,0,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Empfaenger:"/>
                    <TextBox Grid.Column="1" x:Name="txtEmailTo"/>
                </Grid>
                <Grid Margin="0,0,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Betreff:"/>
                    <TextBox Grid.Column="1" x:Name="txtEmailSubject"/>
                </Grid>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Text:"/>
                    <TextBox Grid.Column="1" x:Name="txtEmailBody" Height="60" TextWrapping="Wrap" AcceptsReturn="True"/>
                </Grid>
            </StackPanel>

            <!-- WEBHOOK Parameter -->
            <StackPanel x:Name="pnlWebhook" Visibility="Collapsed">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="URL:"/>
                    <TextBox Grid.Column="1" x:Name="txtWebhookUrl"/>
                </Grid>
            </StackPanel>

            <!-- STATUS Parameter -->
            <StackPanel x:Name="pnlStatus" Visibility="Collapsed">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Neuer Status:"/>
                    <ComboBox Grid.Column="1" x:Name="cmbNeuerStatus">
                        <ComboBoxItem Content="1 - Offen" Tag="1"/>
                        <ComboBoxItem Content="2 - In Bearbeitung" Tag="2"/>
                        <ComboBoxItem Content="3 - Bezahlt" Tag="3"/>
                        <ComboBoxItem Content="4 - Versendet" Tag="4"/>
                        <ComboBoxItem Content="5 - Abgeschlossen" Tag="5"/>
                        <ComboBoxItem Content="6 - Storniert" Tag="6"/>
                    </ComboBox>
                </Grid>
            </StackPanel>

            <!-- SQL Parameter -->
            <StackPanel x:Name="pnlSql" Visibility="Collapsed">
                <TextBlock Text="SQL Statement:"/>
                <TextBox x:Name="txtSqlStatement" Height="80" TextWrapping="Wrap" AcceptsReturn="True" FontFamily="Consolas"/>
            </StackPanel>
        </Grid>

        <!-- Prioritaet und Aktiv -->
        <TextBlock Grid.Row="6" Text="Prioritaet:" VerticalAlignment="Center" Margin="0,0,10,10"/>
        <Grid Grid.Row="6" Grid.Column="1" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="100"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBox x:Name="txtPrioritaet" Text="100" Width="80" HorizontalAlignment="Left"/>
            <CheckBox Grid.Column="1" x:Name="chkAktiv" Content="Workflow aktiv" IsChecked="True" VerticalAlignment="Center"/>
        </Grid>

        <!-- Platzhalter-Info -->
        <TextBlock Grid.Row="7" Grid.ColumnSpan="2" TextWrapping="Wrap" Foreground="Gray" FontSize="11">
            <Run FontWeight="Bold">Verfuegbare Platzhalter:</Run><LineBreak/>
            {BestellNr}, {KundenNr}, {Betrag}, {Status}, {ArtNr}, {Lagerbestand}, {TrackingNr}, {RechnungsNr}, {Id}
        </TextBlock>

        <!-- Buttons -->
        <StackPanel Grid.Row="8" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Speichern" Click="Speichern_Click" Width="100" Padding="10,8"
                    Background="#4CAF50" Foreground="White" BorderThickness="0" Margin="0,0,10,0"/>
            <Button Content="Abbrechen" Click="Abbrechen_Click" Width="100" Padding="10,8"/>
        </StackPanel>
    </Grid>
</Window>
