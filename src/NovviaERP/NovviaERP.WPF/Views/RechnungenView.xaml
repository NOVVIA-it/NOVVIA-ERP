<UserControl x:Class="NovviaERP.WPF.Views.RechnungenView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:base="clr-namespace:NovviaERP.WPF.Controls.Base"
             Background="{DynamicResource BackgroundBrush}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Background="{DynamicResource HeaderBackgroundBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1" Padding="20,15">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="Rechnungen" FontSize="24" FontWeight="SemiBold" Foreground="{DynamicResource HeaderTextBrush}"/>
                <TextBlock x:Name="txtAnzahl" Text="" FontSize="14" Foreground="{DynamicResource MutedTextBrush}" VerticalAlignment="Center" Margin="15,0,0,0"/>
            </StackPanel>
        </Border>

        <!-- Filter mit JTL-Zeitraum (Aktualisierung nur bei Suche!) -->
        <base:FilterBarControl x:Name="filterBar" Grid.Row="1"
            ZeigeZeitraum="True"
            ZeigeNeuButton="False"
            AnzahlText="Rechnungen"
            SucheGestartet="FilterBar_SucheGestartet"/>

        <!-- Rechnungsliste -->
        <Grid Grid.Row="2" Margin="20,15,20,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <DataGrid x:Name="dgRechnungen"
                      AutoGenerateColumns="False" IsReadOnly="True"
                      SelectionMode="Single" SelectionUnit="FullRow"
                      GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                      BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}"
                      RowBackground="White" AlternatingRowBackground="{DynamicResource AlternateRowBrush}"
                      MouseDoubleClick="DG_DoubleClick" SelectionChanged="DG_SelectionChanged">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Rechnungsnr." Binding="{Binding CRechnungsNr}" Width="130"/>
                    <DataGridTextColumn Header="Datum" Binding="{Binding DErstellt, StringFormat=dd.MM.yyyy}" Width="90"/>
                    <DataGridTextColumn Header="Kd-Nr." Binding="{Binding CKundenNr}" Width="80"/>
                    <DataGridTextColumn Header="Kunde" Binding="{Binding KundeName}" Width="150"/>
                    <DataGridTextColumn Header="Firma" Binding="{Binding KundeFirma}" Width="140"/>
                    <DataGridTextColumn Header="Auftrag" Binding="{Binding CAuftragNr}" Width="100"/>
                    <DataGridTextColumn Header="Faellig" Binding="{Binding DFaellig, StringFormat=dd.MM.yyyy}" Width="90"/>
                    <DataGridTextColumn Header="Netto" Binding="{Binding FNetto, StringFormat=N2}" Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Brutto" Binding="{Binding FBrutto, StringFormat=N2}" Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Offen" Binding="{Binding Offen, StringFormat=N2}" Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Offen}" Value="0">
                                        <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn Header="Status" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="3" Padding="6,2" HorizontalAlignment="Left">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="{DynamicResource WarningBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Status}" Value="Bezahlt">
                                                    <Setter Property="Background" Value="{DynamicResource SuccessBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Ueberfaellig">
                                                    <Setter Property="Background" Value="{DynamicResource DangerBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Storniert">
                                                    <Setter Property="Background" Value="{DynamicResource SecondaryBrush}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding Status}" Foreground="White" FontSize="11"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Mahnstufe" Binding="{Binding NMahnstufe}" Width="80">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding NMahnstufe}" Value="0">
                                        <Setter Property="Foreground" Value="#ccc"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Anmerkung" Binding="{Binding CAnmerkung}" Width="200"/>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Summenzeile -->
            <Border Grid.Row="1" Background="{DynamicResource FilterBackgroundBrush}" BorderBrush="{DynamicResource PrimaryBrush}" BorderThickness="1,0,1,1" Padding="10,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock x:Name="txtSummeAnzahl" Text="0 Rechnungen" FontWeight="SemiBold" VerticalAlignment="Center"/>
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <TextBlock Text="Summe Netto:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBlock x:Name="txtSummeNetto" Text="0,00" FontWeight="SemiBold" Width="90" TextAlignment="Right" VerticalAlignment="Center"/>
                        <TextBlock Text="Brutto:" VerticalAlignment="Center" Margin="20,0,5,0"/>
                        <TextBlock x:Name="txtSummeBrutto" Text="0,00" FontWeight="SemiBold" Width="90" TextAlignment="Right" VerticalAlignment="Center"/>
                        <TextBlock Text="Offen:" VerticalAlignment="Center" Margin="20,0,5,0" Foreground="{DynamicResource DangerBrush}"/>
                        <TextBlock x:Name="txtSummeOffen" Text="0,00" FontWeight="Bold" Width="90" TextAlignment="Right" Foreground="{DynamicResource DangerBrush}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Statusleiste -->
        <Border Grid.Row="3" Background="{DynamicResource FilterBackgroundBrush}" Padding="20,10" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="txtStatus" Text="Bereit" Foreground="{DynamicResource MutedTextBrush}"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="btnOeffnen" Content="Oeffnen" Click="Oeffnen_Click" Padding="12,5" IsEnabled="False"/>
                    <Button x:Name="btnAuftrag" Content="Auftrag" Click="Auftrag_Click" Padding="12,5" Margin="10,0,0,0" IsEnabled="False"/>
                    <Button x:Name="btnZahlung" Content="Zahlung erfassen" Click="Zahlung_Click" Padding="12,5" Margin="10,0,0,0"
                            Background="{DynamicResource SuccessBrush}" Foreground="White" BorderThickness="0" IsEnabled="False"/>
                    <Button x:Name="btnStorno" Content="Stornieren" Click="Storno_Click" Padding="12,5" Margin="10,0,0,0"
                            Background="{DynamicResource DangerBrush}" Foreground="White" BorderThickness="0" IsEnabled="False"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
