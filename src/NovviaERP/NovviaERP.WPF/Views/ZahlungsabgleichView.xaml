<UserControl x:Class="NovviaERP.WPF.Views.ZahlungsabgleichView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:NovviaERP.WPF.Views"
             Background="#f5f5f5">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header mit Hauptaktionen (JTL-Style) -->
        <Border Background="White" BorderBrush="#ddd" BorderThickness="0,0,0,1" Padding="15,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Zahlungsverwaltung" FontSize="20" FontWeight="SemiBold" Foreground="#333"/>
                    <TextBlock x:Name="txtAnzahl" Text="" FontSize="13" Foreground="#888" VerticalAlignment="Center" Margin="15,0,0,0"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Abgleich starten" Click="AbgleichStarten_Click"
                            Background="{DynamicResource PrimaryBrush}" Foreground="White" Padding="15,8" BorderThickness="0" Margin="0,0,8,0"
                            FontWeight="SemiBold"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Filter-Bereich (JTL-Style Bereich B) -->
        <Border Grid.Row="1" Background="#f8f9fa" BorderBrush="#ddd" BorderThickness="0,0,0,1" Padding="15,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Konto-Filter -->
                <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                    <TextBlock Text="Konto:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox x:Name="cmbKontoFilter" Width="160" Height="28" SelectionChanged="KontoFilter_Changed">
                        <ComboBoxItem Content="Alle Konten" IsSelected="True"/>
                    </ComboBox>
                </StackPanel>

                <!-- Transaktions-ID -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,20,0">
                    <TextBlock Text="Transaktions-ID:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox x:Name="txtTransaktionsId" Width="140" Height="28" VerticalContentAlignment="Center"
                             KeyDown="TxtTransaktionsId_KeyDown"/>
                </StackPanel>

                <!-- Betrag von/bis -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,20,0">
                    <TextBlock Text="Betrag von:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox x:Name="txtBetragVon" Width="80" Height="28" VerticalContentAlignment="Center"/>
                    <TextBlock Text="bis:" VerticalAlignment="Center" Margin="8,0,5,0"/>
                    <TextBox x:Name="txtBetragBis" Width="80" Height="28" VerticalContentAlignment="Center"/>
                </StackPanel>

                <!-- Sender/Empfaenger -->
                <StackPanel Grid.Column="3" Orientation="Horizontal" Margin="0,0,20,0">
                    <TextBlock Text="Sender/Empfaenger:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox x:Name="txtSenderEmpfaenger" Width="140" Height="28" VerticalContentAlignment="Center"/>
                </StackPanel>

                <!-- Verwendungszweck -->
                <StackPanel Grid.Column="4" Orientation="Horizontal" Margin="0,0,20,0">
                    <TextBlock Text="Verwendungszweck:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox x:Name="txtVerwendungszweck" Width="140" Height="28" VerticalContentAlignment="Center"/>
                </StackPanel>

                <!-- Datumsfilter (JTL-Style: Dropdown) -->
                <StackPanel Grid.Column="6" Orientation="Horizontal">
                    <ComboBox x:Name="cmbZeitraum" Width="130" Height="28" SelectionChanged="Zeitraum_Changed">
                        <ComboBoxItem Content="Alle anzeigen" Tag="ALL"/>
                        <ComboBoxItem Content="Heute" Tag="0"/>
                        <ComboBoxItem Content="Gestern" Tag="1"/>
                        <ComboBoxItem Content="Letzte 7 Tage" Tag="7" IsSelected="True"/>
                        <ComboBoxItem Content="Letzte 30 Tage" Tag="30"/>
                        <ComboBoxItem Content="Dieser Monat" Tag="M"/>
                        <ComboBoxItem Content="Letzter Monat" Tag="LM"/>
                        <ComboBoxItem Content="Dieses Jahr" Tag="Y"/>
                    </ComboBox>
                    <Button Content="Suchen" Click="Suchen_Click" Margin="8,0,0,0" Padding="12,4"
                            Background="{DynamicResource PrimaryBrush}" Foreground="White" BorderThickness="0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Tabs (JTL-Style: Kontobewegungen, Zugewiesene Zahlungen) -->
        <TabControl x:Name="tabZahlungen" Grid.Row="2" Margin="15,10,15,0" BorderThickness="1" BorderBrush="#ddd"
                    SelectionChanged="Tab_Changed">

            <!-- Tab: Kontobewegungen (JTL-Style) -->
            <TabItem Header="Kontobewegungen" Padding="12,5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Unterfilter -->
                    <Border Background="#fff" Padding="8" Margin="0,0,0,5">
                        <StackPanel Orientation="Horizontal">
                            <CheckBox x:Name="chkNurUnmatched" Content="Nur nicht zugeordnete anzeigen"
                                      IsChecked="True" VerticalAlignment="Center"
                                      Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                            <CheckBox x:Name="chkAusgeblendetZeigen" Content="Ausgeblendete anzeigen"
                                      VerticalAlignment="Center" Margin="20,0,0,0"
                                      Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                        </StackPanel>
                    </Border>

                    <!-- DataGrid (JTL-Style Spalten) -->
                    <DataGrid x:Name="dgZahlungen" Grid.Row="1" AutoGenerateColumns="False" IsReadOnly="True"
                              SelectionMode="Extended" SelectionUnit="FullRow"
                              GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                              RowBackground="White" AlternatingRowBackground="#fafafa"
                              SelectionChanged="DG_SelectionChanged">
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Style.Triggers>
                                    <!-- Zugewiesene Zahlungen gruen hinterlegt (JTL-Style) -->
                                    <DataTrigger Binding="{Binding IstZugewiesen}" Value="True">
                                        <Setter Property="Background" Value="#d4edda"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IstAusgeblendet}" Value="True">
                                        <Setter Property="Opacity" Value="0.5"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Buchungsdatum" Binding="{Binding Buchungsdatum, StringFormat=dd.MM.yyyy}" Width="100"/>
                            <DataGridTextColumn Header="Konto" Binding="{Binding KontoName}" Width="120"/>
                            <DataGridTextColumn Header="Betrag" Binding="{Binding Betrag, StringFormat=N2}" Width="100">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Betrag, Converter={x:Static local:IsNegativeConverter.Instance}}" Value="True">
                                                <Setter Property="Foreground" Value="#dc3545"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Buchungstyp" Binding="{Binding Buchungstyp}" Width="100"/>
                            <DataGridTemplateColumn Header="Status" Width="90">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="3" Padding="4,2" HorizontalAlignment="Center">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="#ffc107"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IstZugewiesen}" Value="True">
                                                            <Setter Property="Background" Value="#28a745"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IstTeilzugewiesen}" Value="True">
                                                            <Setter Property="Background" Value="#17a2b8"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="{Binding StatusText}" Foreground="White" FontSize="11"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Nicht zugewiesen" Binding="{Binding RestBetrag, StringFormat=N2}" Width="100">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="Foreground" Value="#dc3545"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Sender/Empfaenger" Binding="{Binding Name}" Width="180"/>
                            <DataGridTextColumn Header="Verwendungszweck" Binding="{Binding Verwendungszweck}" Width="*"/>
                            <DataGridTextColumn Header="Transaktions-ID" Binding="{Binding TransaktionsId}" Width="150"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Aktionsleiste (JTL-Style) -->
                    <Border Grid.Row="2" Background="#f0f0f0" Padding="10,8" Margin="0,5,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal">
                                <Button x:Name="btnManuellZuweisen" Content="Manuell zuweisen..." Click="Zuordnen_Click"
                                        Padding="12,5" IsEnabled="False" Margin="0,0,8,0"/>
                                <Button x:Name="btnAutoZuweisen" Content="Automatisch zuweisen" Click="AutoMatch_Click"
                                        Padding="12,5" Background="#28a745" Foreground="White" BorderThickness="0" Margin="0,0,8,0"/>
                                <Button x:Name="btnAusblenden" Content="Kontobewegung ausblenden" Click="Ausblenden_Click"
                                        Padding="12,5" IsEnabled="False" Margin="0,0,8,0"/>
                                <Button x:Name="btnRueckbuchung" Content="Rueckbuchung Restbetrag..." Click="Rueckbuchung_Click"
                                        Padding="12,5" IsEnabled="False"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <TextBlock x:Name="txtSummeAnzahl" Text="0 Kontobewegungen" VerticalAlignment="Center" Margin="0,0,15,0"/>
                                <TextBlock Text="Summe:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBlock x:Name="txtSummeBetrag" Text="0,00" FontWeight="Bold" Width="100" TextAlignment="Right" VerticalAlignment="Center"/>
                                <TextBlock Text="EUR" VerticalAlignment="Center" Margin="5,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Tab: Zugewiesene Zahlungen (JTL-Style) -->
            <TabItem Header="Zugewiesene Zahlungen" Padding="12,5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <DataGrid x:Name="dgZugewiesen" AutoGenerateColumns="False" IsReadOnly="True"
                              SelectionMode="Single" SelectionUnit="FullRow"
                              GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                              RowBackground="White" AlternatingRowBackground="#fafafa">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Buchungsdatum" Binding="{Binding Buchungsdatum, StringFormat=dd.MM.yyyy}" Width="100"/>
                            <DataGridTextColumn Header="Betrag" Binding="{Binding Betrag, StringFormat=N2}" Width="100">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Rechnung" Binding="{Binding RechnungsNr}" Width="120"/>
                            <DataGridTextColumn Header="Bestellung" Binding="{Binding BestellNr}" Width="120"/>
                            <DataGridTextColumn Header="Kunde" Binding="{Binding KundeName}" Width="200"/>
                            <DataGridTextColumn Header="Zugewiesen am" Binding="{Binding ZugewiesenAm, StringFormat=dd.MM.yyyy HH:mm}" Width="130"/>
                            <DataGridTextColumn Header="Verwendungszweck" Binding="{Binding Verwendungszweck}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Border Grid.Row="1" Background="#f0f0f0" Padding="10,8" Margin="0,5,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button Content="Zuweisung aufheben" Click="ZuweisungAufheben_Click" Padding="12,5"/>
                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <TextBlock x:Name="txtZugewiesenAnzahl" Text="0 zugewiesene Zahlungen" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Tab: SEPA Lastschriften -->
            <TabItem Header="SEPA Lastschriften" Padding="15,5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- SEPA Header -->
                    <Border Background="#f8f8f8" Padding="10" Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Faellige SEPA-Lastschriften" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <Button Content="Alle auswaehlen" Click="SepaAlleAuswaehlen_Click"
                                    Padding="10,4" Margin="20,0,0,0"/>
                            <Button Content="SEPA-XML exportieren" Click="SepaExport_Click"
                                    Background="{DynamicResource PrimaryBrush}" Foreground="White" Padding="12,4" Margin="10,0,0,0" BorderThickness="0"/>
                        </StackPanel>
                    </Border>

                    <!-- SEPA DataGrid -->
                    <DataGrid x:Name="dgSepa" Grid.Row="1" AutoGenerateColumns="False" IsReadOnly="False"
                              SelectionMode="Extended" SelectionUnit="FullRow"
                              GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                              RowBackground="White" AlternatingRowBackground="#fafafa">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="" Binding="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="30"/>
                            <DataGridTextColumn Header="Rechnung" Binding="{Binding CRechnungsnummer}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Kunde" Binding="{Binding KundeName}" Width="200" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Betrag" Binding="{Binding Offen, StringFormat=N2}" Width="100" IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Faelligkeit" Binding="{Binding Faelligkeit, StringFormat=dd.MM.yyyy}" Width="90" IsReadOnly="True"/>
                            <DataGridTextColumn Header="IBAN" Binding="{Binding CIBAN}" Width="200" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Mandatsreferenz" Binding="{Binding CMandatsreferenz}" Width="150" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- SEPA Summenzeile -->
                    <Border Grid.Row="2" Background="#e8f4fc" BorderBrush="{DynamicResource PrimaryBrush}" BorderThickness="0,1,0,0" Padding="10,8" Margin="0,5,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock x:Name="txtSepaAnzahl" Text="0 Lastschriften" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <TextBlock Text="Summe:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBlock x:Name="txtSepaSumme" Text="0,00" FontWeight="Bold" Width="100" TextAlignment="Right" VerticalAlignment="Center"/>
                                <TextBlock Text="EUR" VerticalAlignment="Center" Margin="5,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- Tab: PayPal/Mollie Transaktionen -->
            <TabItem Header="Transaktionen (PayPal/Mollie)" Padding="15,5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Provider Buttons -->
                    <Border Background="#f8f8f8" Padding="10" Margin="0,0,0,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal">
                                <Button x:Name="btnPayPalSync" Content="PayPal abrufen" Click="PayPalSync_Click"
                                        Background="#003087" Foreground="White" Padding="12,6" BorderThickness="0" Margin="0,0,10,0"/>
                                <Button x:Name="btnMollieSync" Content="Mollie abrufen" Click="MollieSync_Click"
                                        Background="#0a0a0a" Foreground="White" Padding="12,6" BorderThickness="0" Margin="0,0,10,0"/>
                                <TextBlock x:Name="txtProviderStatus" Text="" VerticalAlignment="Center" Foreground="#666" Margin="10,0,0,0"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <ComboBox x:Name="cmbProviderFilter" Width="100" SelectedIndex="0" SelectionChanged="ProviderFilter_Changed">
                                    <ComboBoxItem Content="Alle"/>
                                    <ComboBoxItem Content="PayPal"/>
                                    <ComboBoxItem Content="Mollie"/>
                                </ComboBox>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Provider Transaktionen -->
                    <DataGrid x:Name="dgProvider" Grid.Row="1" AutoGenerateColumns="False" IsReadOnly="True"
                              SelectionMode="Single" SelectionUnit="FullRow"
                              GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                              RowBackground="White" AlternatingRowBackground="#fafafa"
                              SelectionChanged="DgProvider_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Anbieter" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Padding="4,2" CornerRadius="3" HorizontalAlignment="Center">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="#6c757d"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Provider}" Value="PayPal">
                                                            <Setter Property="Background" Value="#003087"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Provider}" Value="Mollie">
                                                            <Setter Property="Background" Value="#0a0a0a"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="{Binding Provider}" Foreground="White" FontSize="11"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Datum" Binding="{Binding Datum, StringFormat=dd.MM.yyyy HH:mm}" Width="130"/>
                            <DataGridTextColumn Header="Betrag" Binding="{Binding Betrag, StringFormat=N2}" Width="100">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IstRefund}" Value="True">
                                                <Setter Property="Foreground" Value="#dc3545"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTemplateColumn Header="Status" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Padding="4,2" CornerRadius="3" HorizontalAlignment="Center">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="#ffc107"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="paid">
                                                            <Setter Property="Background" Value="#28a745"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="S">
                                                            <Setter Property="Background" Value="#28a745"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="COMPLETED">
                                                            <Setter Property="Background" Value="#28a745"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="refunded">
                                                            <Setter Property="Background" Value="#6c757d"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="failed">
                                                            <Setter Property="Background" Value="#dc3545"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="{Binding Status}" Foreground="White" FontSize="11"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Transaktion-ID" Binding="{Binding Id}" Width="180"/>
                            <DataGridTextColumn Header="Beschreibung" Binding="{Binding Beschreibung}" Width="200"/>
                            <DataGridTextColumn Header="Kunde" Binding="{Binding Kunde}" Width="150"/>
                            <DataGridTextColumn Header="Rechnung" Binding="{Binding RechnungNr}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Aktionen -->
                    <Border Grid.Row="2" Background="#e8f4fc" BorderBrush="{DynamicResource PrimaryBrush}" BorderThickness="0,1,0,0" Padding="10,8" Margin="0,5,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock x:Name="txtProviderInfo" Text="0 Transaktionen" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button x:Name="btnRefund" Content="Rueckzahlung" Click="Refund_Click"
                                        Background="#dc3545" Foreground="White" Padding="15,6" BorderThickness="0" IsEnabled="False"/>
                                <Button x:Name="btnTxDetails" Content="Details" Click="TxDetails_Click"
                                        Padding="15,6" Margin="10,0,0,0" IsEnabled="False"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Statusleiste -->
        <Border Grid.Row="3" Background="#f0f0f0" Padding="15,8" BorderBrush="#ddd" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="txtStatus" Text="Bereit" Foreground="#666" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="MT940 Import" Click="ImportMT940_Click"
                            Padding="10,5" Margin="0,0,8,0"/>
                    <Button Content="CAMT Import" Click="ImportCAMT_Click"
                            Padding="10,5" Margin="0,0,8,0"/>
                    <Button x:Name="btnDetails" Content="Details anzeigen" Click="Details_Click"
                            Padding="10,5" IsEnabled="False"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
